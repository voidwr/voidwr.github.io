<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>voidwr - OxFun - Shell</title>
  <link rel="stylesheet" href="/staging/assets/css/writeups.css">
</head>
<body>

<!-- NAVIGATION -->
<nav class="navbar">
  <ul class="nav-menu">
    <li><a href="/index.html" class="nav-link">üè† Home</a></li>
    <li><a href="/writeups.html" class="nav-link">üìù Writeups</a></li>
    <li><a href="/about.html" class="nav-link">‚ù§Ô∏è About</a></li>
  </ul>
</nav>

<!-- WRITEUP CONTENT -->
<section class="writeup-hero">
  <div class="writeup-hero-overlay"></div>
  <div class="writeup-hero-content">
    <h1>OxFun CTF 2026 - Shell</h1>
  </div>
</section>

<section class="writeup-content">
  <a href="0xfun.html" class="writeups-back-link">Back to 0xFun</a>
  <a href="/writeups.html" class="writeups-back-link">Back to Writeups</a>
  
  <div class="writeup-body">
    <h2>Overview</h2>
    <div class="writeup-banner-full-width">
      <img src="/staging/writeups/ctf/0xfun/media/Shell-web/prompt.png" alt="Prompt" class="writeup-banner-link" onclick="openImageModal(this)">
    </div>
    <p>
      Shell was one of those challenges that remind you 
      that CTFs are not only about complex exploitation techniques but also about 
      paying attention to details and thinking outside the box.
    </p>

    <h2>Challenge</h2>
    <p>
      Some metadata might be examined really closely.
    </p>
    
        <div class="code-block">
      <div class="code-header">Prompt</div>
      <pre>
        <code>
        This simple web app lets you upload images to inspect their EXIF meatadata.
        But somthing feels off... maybe your uploads are being examined more closely
        than you realize. Can you get the server to execute a command of your choosing 
        and exspose the hidden flag.txt file?
        </code>
    </div>

    <h2>Flag</h2>
    <p>
      When we start the challenge we are presented with a simple web 
      app that has only a browse button and an upload button.
    </p>

    <div class="gallery-item">
        <img src="/staging/writeups/ctf/0xfun/media/Shell-web/web-page.png" alt="Initial View" class="gallery-image" onclick="openImageModal(this)">
        <p class="image-caption">Figure 1: Initial view of the web app.</p>
    </div>

    <p>
        We can understand from the prompt and from the title of the web app that 
        there might be some arbitary code execution with <code>exiftool</code>.
    </p>

    <p>
      <code>Exiftool</code> is an open-source software
      that is used to read and write EXIF metadata in files. 
      It is a very powerful tool that can be used for a variety of purposes, including:
      <ul>
        <li>Extracting metadata from files</li>
        <li>Modifying metadata in files</li>
        <li>Creating new metadata for files</li>
      </ul>
    </p>
    
    <p>
      With that said let's find a beautiful non malicious picture to upload to 
      the site and see if we can find any vulnerabilities 
      in the way the site handles the metadata of the picture.
    </p>

    <div class="gallery-item">
        <img src="/staging/writeups/ctf/0xfun/media/Shell-web/initial.png" alt="Initial Picture" class="gallery-image" onclick="openImageModal(this)">
        <p class="image-caption">Figure 2: Picture Upload.</p>
    </div>

    <p>
        We see <code>ExifTool Version Number: 12.16</code>
        Exiftool had a command injection vulnerability in versions prior to 12.25, 
        so we can try to exploit it by fabricating our image to carry malicious payload
        in its metadata, and at the time of read, we can get the server to execute our code.
    </p>

    <p>
      Specifically the National Vulnerability Database states that for <code>CVE-2021-22204</code>, 
      improper neutralization of user data in the DjVu file format in ExifTool 
      (<strong>versions 7.44 and up</strong>) allows for arbitrary code execution 
      when parsing the malicious image. 
    </p>  

    <p>
      DjVu is a file format that is used to store scanned documents. 
      It is a very efficient format that can store even high-quality images 
      in a very small file size.
    </p>

    <p>
      A PoC for this vulnerability is available on GitHub and we can use 
      it to create our malicious image. The PoC is a Python script that uses the
      metadata tag to create a perlscript inside the metadata of the image and compressing
      it with the bzz algorithm which is a similar compression family as bzip2. 
    </p>

    <p>
      So let's run the script and do the command <code>find / | grep "flag.txt"</code>
      and upload it to the server.
    </p>

    <div class="gallery-item">
        <img src="/staging/writeups/ctf/0xfun/media/Shell-web/exploit_find_grep_flag.png" alt="Exploit" class="gallery-image" onclick="openImageModal(this)">
        <p class="image-caption">Figure 3: Exploit.</p>
    </div>

    <div class="gallery-item">
        <img src="/staging/writeups/ctf/0xfun/media/Shell-web/exploit_find_grep_flag_output.png" alt="Exploit Output" class="gallery-image" onclick="openImageModal(this)">
        <p class="image-caption">Figure 4: Exploit Output.</p>
    </div>
    
    <p>
      We see that flag.txt resides in the root directory. So let's re run the script to 
      create another image but this time with the command <code>cat /flag.txt</code> 
      to get the flag.
    </p>

    <div class="gallery-item">
        <img src="/staging/writeups/ctf/0xfun/media/Shell-web/cat_flag.png" alt="Cat Flag" class="gallery-image" onclick="openImageModal(this)">
        <p class="image-caption">Figure 5: Cat Flag.</p>
    </div>

    <div class="gallery-item">
        <img src="/staging/writeups/ctf/0xfun/media/Shell-web/cat_flag_output.png" alt="Cat Flag Output" class="gallery-image" onclick="openImageModal(this)">
        <p class="image-caption">Flag: <strong>0xfun{h1dd3n_p4yl04d_1n_pl41n_51gh7}</strong>.</p>
    </div>
    
    <!-- ===== REFERENCES SECTION ===== -->
    <h2>References</h2>
    <div class="references-grid">
      <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-22204" target="_blank" class="reference-card">
        <div class="reference-icon"></div>
        <h3>NVD Nist</h3>
        <p>NVD - cve-2021-22204. (n.d.). https://nvd.nist.gov/vuln/detail/cve-2021-22204</p>
        <span class="reference-link">nvd.nist.gov</span>
      </a>
      <a href="https://github.com/UNICORDev/exploit-CVE-2021-22204" target="_blank" class="reference-card">
        <div class="reference-icon"></div>
        <h3>CVE-2021-22204</h3>
        <p>UNICORDev. (n.d.). GitHub - UNICORDev/Exploit-CVE-2021-22204: 
          Exploit for CVE-2021-22204 (EXIFTool) - Arbitrary Code Execution. 
          GitHub. https://github.com/UNICORDev/exploit-CVE-2021-22204</p>
        <span class="reference-link">github.com</span>
      </a>
    </div>


    <!-- ========== END TEMPLATE SECTIONS ========== -->
  </div>
  <a href="0xfun.html" class="writeups-back-link">Back to 0xFun</a>
</section>
 

<script src="/staging/assets/js/main.js"></script>
<script src="/staging/assets/js/writeups.js"></script>
</body>
</html>
